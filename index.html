<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>New Tab</title>
  <link rel="manifest" href="/install/manifest.json" />
  <style>
    html, body {
      margin: 0; padding: 0;
      height: 100%; width: 100%;
      overflow: hidden;
      background: black;
      font-family: sans-serif;
    }
    /* Existing iframe style for the game */
    iframe {
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      border: none;
      background: black;
    }
    /* Floating Menu Button (image only) */
    #menu-btn {
      position: fixed;
      top: 12px;
      left: 12px;
      /* KEPT LOW so Google Overlay covers it */
      z-index: 10000; 
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      transition: opacity 0.4s ease;  /* fade animation */
    }
    #menu-btn img {
      width: 60px;
      height: 60px;
    }

    /* Overlay background */
    #overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      /* KEPT LOW so Google Overlay covers it */
      z-index: 9998; 
      display: none;
      transition: opacity 0.4s ease;  /* fade animation */
    }

    /* Menu Box */
    #menu-box {
      position: fixed;
      top: 80px;
      left: 12px;
      background: rgba(0,0,0,0.9);
      border-radius: 16px;
      padding: 12px;
      display: none;
      flex-direction: column;
      gap: 12px;
      /* UPDATED: Use max-content to fit the longest button's content */
      width: max-content; 
      /* KEPT LOW so Google Overlay covers it */
      z-index: 9999; 
      border: 2px solid white;
      transition: opacity 0.4s ease;  /* fade animation */
    }
    .menu-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px; /* Adjusted padding to better fit larger icon */
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      cursor: pointer;
      color: white;
      font-size: 14px;
      font-weight: bold;
      white-space: nowrap; /* force one line */
    }
    .menu-item:hover {
      background: rgba(255,255,255,0.2);
    }
    .menu-item img {
      /* UPDATED: Larger icons */
      width: 36px;
      height: 36px;
    }
    
    /* NEW: Google Overlay Iframe Style */
    #google-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; 
      height: 100%;
      border: none;
      /* INCREASED Z-INDEX to cover menu system (10000) */
      z-index: 10004; 
      background: white;
      opacity: 0; /* Start hidden */
      pointer-events: none; /* Ignore clicks when hidden */
      transition: opacity 0.3s ease;
    }

    /* UPDATED: Bottom Tab-Switch Island Style (Highly Transparent, No Dot) */
    #toggle-island {
        position: fixed;
        bottom: 12px;
        left: 50%;
        transform: translateX(-50%);
        width: 100px; /* Longer width */
        height: 22px; /* Shorter height */
        background: rgba(255, 255, 255, 0.05); /* WAY more transparent */
        backdrop-filter: blur(10px); /* Increased blur for better effect */
        border-radius: 11px; /* Half of height */
        /* HIGHEST Z-INDEX so it stays on top of Google overlay */
        z-index: 10005; 
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        user-select: none;
        box-shadow: 0 1px 6px rgba(0, 0, 0, 0.4); /* Softer shadow */
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.05); /* Even subtler border */
    }
    #toggle-island:hover {
        background: rgba(255, 255, 255, 0.15); /* Slightly visible on hover */
    }
  </style>
</head>
<body>

  <button id="menu-btn"><img src="https://4texas4.github.io/media/menu.png" alt="Menu"></button>

  <div id="overlay"></div>

  <div id="menu-box">
    
    <div class="menu-item" onclick="goHome()">
      <img src="https://4texas4.github.io/media/homeicon.png" alt="Home"> Home
    </div>

    <div class="menu-item" onclick="toggleFullscreen()">
      <img src="https://4texas4.github.io/media/fullscreen.png" alt="Fullscreen"> Fullscreen
    </div>

    <div class="menu-item" onclick="removeMenu()">
      <img src="https://4texas4.github.io/media/no-menu.png" alt="Remove Menu"> Remove 3 Lines
    </div>

    <div class="menu-item" id="installBtn" style="display:none;">
      <img src="https://4texas4.github.io/media/install.png" alt="Install"> Install
    </div>
  </div>

  <iframe id="game-iframe" src="https://4texas4.github.io/files/home.html" allow="autoplay; encrypted-media; pointer-lock"></iframe>

  <iframe 
    id="google-overlay" 
    src="https://www.google.com?igu=1" 
    title="Google Overlay">
  </iframe>
  
  <div id="toggle-island" onclick="toggleOverlay(!isOverlayVisible)">
    </div>

  <script>
    const menuBtn = document.getElementById('menu-btn');
    const menuBox = document.getElementById('menu-box');
    const overlay = document.getElementById('overlay');
    const iframe = document.getElementById('game-iframe');
    
    // ELEMENTS FOR TAB SWITCHING
    const googleOverlay = document.getElementById('google-overlay');
    const island = document.getElementById('toggle-island');

    // STATE
    // CLEANUP: Removed unused 'isIslandVisible' variable
    let isOverlayVisible = false;

    /**
     * Toggles the visibility and interactivity of the Google overlay iframe.
     * @param {boolean} show - True to show, False to hide.
     */
    function toggleOverlay(show) {
      if (show) {
          // REFRESH: Reload the Google iframe to its initial state when opening
          googleOverlay.src = "https://www.google.com?igu=1";
          
          // Show overlay: make it fully opaque and allow mouse interaction
          googleOverlay.style.opacity = '1';
          googleOverlay.style.pointerEvents = 'auto';
      } else {
          // Hide overlay: make it transparent and block mouse interaction
          googleOverlay.style.opacity = '0';
          googleOverlay.style.pointerEvents = 'none';
      }
      isOverlayVisible = show;
      // Ensure the menu closes if it was open (safety call)
      closeMenu(); 
    }

    // Toggle menu
    menuBtn.onclick = () => {
      const open = menuBox.style.display === "flex";
      if (open) {
        menuBox.style.opacity = 0;
        overlay.style.opacity = 0;
        setTimeout(() => {
          menuBox.style.display = "none";
          overlay.style.display = "none";
        }, 400);
      } else {
        menuBox.style.display = "flex";
        overlay.style.display = "block";
        setTimeout(() => {
          menuBox.style.opacity = 1;
          overlay.style.opacity = 1;
        }, 10);
      }
    };
    overlay.onclick = () => {
      closeMenu();
    };

    function closeMenu() {
      menuBox.style.opacity = 0;
      overlay.style.opacity = 0;
      setTimeout(() => {
        menuBox.style.display = "none";
        overlay.style.display = "none";
      }, 400);
    }

    // Menu actions
    function goHome() {
      iframe.src = "https://4texas4.github.io/files/home.html";
      closeMenu();
    }
    
    /**
     * Toggles fullscreen on the entire document (<html> element).
     * This keeps fixed position elements (like the menu and island) visible.
     */
    function toggleFullscreen() {
      // FIX: Target the <html> element (document.documentElement) instead of the iframe
      const docEl = document.documentElement; 
      closeMenu();

      if (!document.fullscreenElement) {
        // Enter fullscreen
        docEl.requestFullscreen?.() || docEl.webkitRequestFullscreen?.() || docEl.msRequestFullscreen?.();
      } else {
        // Exit fullscreen
        document.exitFullscreen?.() || document.webkitExitFullscreen?.() || document.msExitFullscreen?.();
      }
    }
    // END OF FULLSCREEN CHANGE

    function removeMenu() {
      // fade out all menu elements
      menuBtn.style.opacity = 0;
      menuBox.style.opacity = 0;
      overlay.style.opacity = 0;
      setTimeout(() => {
        menuBtn.remove();
        menuBox.remove();
        overlay.remove();
      }, 400); // match transition duration
    }

    // PWA Install
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installBtn').style.display = 'flex';
    });

    document.getElementById('installBtn').onclick = () => {
      deferredPrompt.prompt();
      deferredPrompt.userChoice.finally(() => {
        deferredPrompt = null;
        document.getElementById('installBtn').style.display = 'none';
      });
    };
  </script>
</body>
</html>
